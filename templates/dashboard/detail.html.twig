{% extends 'base.html.twig' %}
{% block title %}{% trans %}Printer Detail{% endtrans %}{% endblock %}

{% block body %}
    <div class="container">

        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5>Printer Information</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-lg-9">
                                <dl class="row">
                                    <dt class="col-sm-2">ID</dt>
                                    <dd class="col-sm-4">{{ printer.id }} <a href="{{ path('printer_edit', {'id': printer.id}) }}" class="link-unstyled" title="{% trans %}Edit{% endtrans %}"> <i class="fas fa-edit"></i></a></dd>
                                    <dt class="col-sm-2">{% trans %}IP{% endtrans %}</dt>
                                    <dd class="col-sm-4">{{ printer.ip }} <a href="https://{{ printer.ip }}" class="link-unstyled" target="_blank" title="{% trans %}Open Web Interface{% endtrans %}"> <i class="fas fa-link"></i></a></dd>

                                    <dt class="col-sm-2">{% trans %}Name{% endtrans %}</dt>
                                    <dd class="col-sm-4">{{ printer.name }}</dd>
                                    <dt class="col-sm-2">{% trans %}SerialNumber{% endtrans %}</dt>
                                    <dd class="col-sm-4">{{ printer.serialNumber }}</dd>

                                    <dt class="col-sm-2">{% trans %}Location{% endtrans %}</dt>
                                    <dd class="col-sm-4">{{ printer.location }}</dd>
                                    <dt class="col-sm-2">{% trans %}LastCheck{% endtrans %}</dt>
                                    <dd class="col-sm-4">{{ printer.lastCheck|date("d.m.Y H:i:s") }}</dd>

                                    <dt class="col-sm-2">{% trans %}Type{% endtrans %}</dt>
                                    <dd class="col-sm-4">{{ printer.type }}</dd>
                                    <dt class="col-sm-2">{% trans %}ColorPrinter{% endtrans %}</dt>
                                    <dd class="col-sm-4">{% if printer.isColorPrinter %}{% trans %}yes{% endtrans %}{% else %}{% trans %}no{% endtrans %}{% endif %}</dd>

                                    <dt class="col-sm-2">{% trans %}TotalPages{% endtrans %}</dt>
                                    <dd class="col-sm-10">{{ printer.totalPages }}</dd>

                                    <dt class="col-sm-2">{% trans %}Toner{% endtrans %}</dt>
                                    <dd class="col-sm-4">
                                        <div class="progress" style="height: 20px;">
                                            <div class="progress-bar bg-black" role="progressbar" style="width: {{ printer.tonerblack }}%" aria-valuenow="{{ printer.tonerblack }}" aria-valuemin="0" aria-valuemax="100">
                                                {{ printer.tonerblack }} %
                                            </div>
                                        </div>
                                        {% if printer.iscolorprinter %}
                                            <div class="progress">
                                                <div class="progress-bar bg-yellow" role="progressbar" style="width: {{ printer.toneryellow }}%" aria-valuenow="{{ printer.tonerblack }}" aria-valuemin="0" aria-valuemax="100"></div>
                                            </div>
                                            <div class="progress">
                                                <div class="progress-bar bg-magenta" role="progressbar" style="width: {{ printer.tonermagenta }}%" aria-valuenow="{{ printer.tonerblack }}" aria-valuemin="0" aria-valuemax="100"></div>
                                            </div>
                                            <div class="progress">
                                                <div class="progress-bar bg-cyan" role="progressbar" style="width: {{ printer.tonercyan }}%" aria-valuenow="{{ printer.tonerblack }}" aria-valuemin="0" aria-valuemax="100"></div>
                                            </div>
                                        {% endif %}
                                    </dd>
                                    <dd class="col-sm-6"></dd>

                                    {% if printer.unreachableCount != 0 %}
                                    <dt class="col-sm-2">{% trans %}Unreachable{% endtrans %}</dt>
                                    <dd class="col-sm-10 text-danger">{% trans with  {'%c%': printer.unreachableCount} %}%c% times{% endtrans %}</dd>
                                    {% endif %}
                                </dl>
                            </div>
                            <div class="col-lg-3">
                                {{ getPrinterImage(printer.type)|raw }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!--<div class="row">
            <h3>Asset Details</h3>
            <div class="col12">

            </div>
        </div>-->

        <div class="row mt-3">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5>{% trans %}Toner History{% endtrans %}</h5>
                    </div>
                    <div class="card-body">
                        <div class="col12">
                            <canvas id="chartToner" width="400" height="100"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row mt-3">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5>{% trans %}TotalPage History{% endtrans %}</h5>
                    </div>
                    <div class="card-body">
                        <div class="col12">
                            <canvas id="chartPages" width="400" height="100"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
{% endblock %}

{% block stylesheets %}
    <style href="{{ asset('css/Chart.min.css') }}" rel="stylesheet"></style>
{% endblock %}
{% block javascripts %}
    <script src="{{ asset('js/Chart.bundle.min.js') }}" type="text/javascript"></script>

    <script type="text/javascript">

        var label = [];
        var pagesData = [];
        var tonerData = [];
        {% for history in printer.printerHistories %}
        label.push('{{ history.timestamp|date("d.m.Y H:i:s") }}');
        pagesData.push({{ history.totalpages }});
        tonerData.push({{ history.tonerblack }});
        {% endfor %}

        var options = {};
        var dataToner = {
            "labels": label.reverse(),
            "datasets":[
                {
                    "label":"{% trans %}Black{% endtrans %}",
                    "data":tonerData,
                    "fill":false,
                    "borderColor":"black",
                    "lineTension":0.1
                }]
        };

        var dataPages = {
            "labels":label.reverse(),
            "datasets":[
                {
                    "label":"{% trans %}Total Pages{% endtrans %}",
                    "data":pagesData,
                    "fill":false,
                    "borderColor":"black",
                    "lineTension":0.1
                }]
        };

        var ctT = document.getElementById('chartToner').getContext('2d');
        var chartToner = new Chart(ctT, {
            type: 'line',
            data: dataToner,
            options: options
        });

        var ctP = document.getElementById('chartPages').getContext('2d');
        var chartPages = new Chart(ctP, {
            type: 'line',
            data: dataPages,
            options: {legend: false}
        });

    </script>
{% endblock %}